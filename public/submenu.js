!function (a) { a.fn.submenu = function () { return this.each(function () { for (var g = a(this), f = g.find("> li").children("a"), j = f.length, e = 0; e < j; e++) { var d = f.eq(e), c = d.text(); if ("_" !== c.charAt(0) && "_" !== c.charAt(1)) { var h = f.eq(e + 1).text(); if ("_" === h.charAt(0) && "_" !== h.charAt(1)) { var i = f.eq(e + 2).text(); if ("_" === i.charAt(0) && "_" === i.charAt(1)) { var b = d.parent(); b.hasClass("hasMega") || b.addClass("hasMenu").append('<ul class="subMenu chunked"/>') } else { var b = d.parent(); b.hasClass("hasMega") || b.addClass("hasMenu").append('<ul class="subMenu"/>') } } } "_" !== c.charAt(0) || "_" === c.charAt(1) || b.hasClass("hasMega") || (d.text(c.replace("_", "")), d.parent().appendTo(b.children(".subMenu"))), "_" !== c.charAt(0) || "_" !== c.charAt(1) || b.hasClass("hasMega") || (d.text(c.replace("__", "")), d.parent().addClass("isFirst").appendTo(b.children(".subMenu.chunked"))) } var k = g.find(".subMenu.chunked").find("li:not(.isFirst)"); k.each(function () { $(this).nextUntil(k).wrapAll('<div class="itemsWrapped"></div>'), $(this).prependTo($(this).next(".itemsWrapped")) }) }) } }(jQuery);